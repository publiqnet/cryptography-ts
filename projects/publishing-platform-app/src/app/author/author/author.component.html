<div class="vh-centered" *ngIf="loadingAuthor">
    <mat-spinner></mat-spinner>
</div>
<ng-container *ngIf="false">
    <div class="author-header-wrap profile-bg" *ngIf="!loadingAuthor" style="background: #fff;">
        <div class="inner-wrap title-wrap">
            <div class="background vh-centered"></div>
            <div class="avatar-wrap">
                <div class="avatar" [ngStyle]="{'background-image': avatarUrl ? 'url(' + avatarUrl + ')' : 'url(/assets/no-image-article.jpg)'}">
                    <span *ngIf="(!avatarUrl && shortName)" class="vh-centered">{{shortName}}</span>
                </div>
            </div>
            <div style="z-index: 1;position: relative;">
                <h1 id="a-title">{{ author?.firstName }} {{ author?.lastName }}</h1>
                <h3>
                    {{'author.rating' | translate}}
                    <span>{{author && author.rating ? author.rating.toFixed(1) : 0}}</span> {{'author.followers' | translate}}
                    <span id="followers-count">{{author && author.subscribersCount ? author.subscribersCount : 0}}</span> {{'author.stories' | translate}}
                    <span>{{author && author.articlesCount ? author.articlesCount : 0}}</span> {{'author.views' | translate}}
                    <span>{{author && author.views ? author.views : 0}}</span>
                </h3>
                <div *ngIf="author && !isCurrentUser; else settings" class="text-center text-md-left mt-3">
                    <div [ngClass]="{'follow-button': true}">
                        <i class="mr-2" [ngClass]="canFollow ? 'icon-follow' : 'icon-unfollow'"></i>
                        <span>{{(canFollow ? 'author.follow' : 'author.unfollow') | translate}}</span>
                    </div>
                </div>
                <ng-template #settings>
                    <div class="text-center text-md-left mt-3">
                        <div [routerLink]="['/user/settings']" class="follow-button">
                            <i class="icon-settings mr-1"></i>
                            <span>{{"header.settings" | translate}}</span>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>

</ng-container>

<div class="content" *ngIf="author">
    <div class="container">
        <form class="form" *ngIf="authorForm" novalidate (ngSubmit)="onSubmit()" [formGroup]="authorForm">
            <div class="row profile-metadata">
                <div class="col-2 profile-metadata__avatar profile-metadata__avatar--editable">
                    <div class="profile-metadata__hover" [ngClass]="{'hover-avatar' : isCurrentUser}">
                        <ui-avatar [size]="'large'" [avatarData]="{'image': getCurrentImage(), 'fullName': author.fullName}"></ui-avatar>
                        <i class="icon-close" [ngClass]="{'icon-close--hover' : (currentImage !== author.image) && isCurrentUser}" (click)="resetCurrentImage()"></i>
                        <label class="profile-metadata__hover__upload" for="profilePic">
              <input type="file" (change)="showUploadedImage($event)" accept="image/jpeg,image/png" id="profilePic" *ngIf="isCurrentUser">
              <i class="icon-camera"></i>
              <small>Upload</small>
            </label>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-7 col-10">
                    <h1 class="profile-metadata__fullname">
                        <label>
                        <textarea [attr.contenteditable]="isCurrentUser" contenteditable="true" [placeholder]="isCurrentUser ? 'Add your name' : ''" #authorName (keyup)="onNameEdit($event)" class="author-fullname" rows="1" [readonly]="!isCurrentUser">{{author.fullName}}</textarea>
                         <i class="icon-edit editable-icon" [ngClass]="editTitleIcon ? 'active-icon' : ''" ></i>
                      </label>
                    </h1>
                    <h3 class="profile-metadata__bio">
                        <label>
                        <textarea [attr.contenteditable]="isCurrentUser" [placeholder]="isCurrentUser ? 'Write a short bio' : ''" #bioText (keyup)="onBioEdit($event)" class="author-bio" rows="1" [readonly]="!isCurrentUser">{{author.bio}}</textarea>
                        <i class="icon-edit editable-icon" [ngClass]="editBioIcon ? 'active-icon' : ''" ></i>
                      </label>
                    </h3>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-3 col-12">
                    <div class="edit-menu">
                        <ng-container *ngIf="isCurrentUser">
                            <ui-button *ngIf="editMode || showEditModeIcons" [type]="'primary'" [size]="'medium'" [text]="'Save'" [disabled]="disableSave"></ui-button>
                            <div class="button button--icon" (click)="onEditMode(true)" *ngIf="!editMode && !showEditModeIcons">
                                <i class="icon-settings"></i>
                            </div>
                            <ui-button [iconButton]="true" [iconClassName]="'close'" (btnClicked)="resetValues()" *ngIf="editMode || showEditModeIcons" [className]="'author-close-icon'"></ui-button>
                        </ng-container>
                        <div *ngIf="!isCurrentUser">
                            <ui-button [type]="'primary'" [iconClassName]="'follow'" [size]="'medium'" [text]="'Follow'" (click)="onFollowClick($event)"></ui-button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <div class="row profile-statistics" [ngClass]="{'editable-disabled' : editMode}">
            <div class="col-lg-2 offset-lg-2 col-3 offset-0">
                <div class="datum">
                    <span class="datum__value">{{author && author.rating ? author.rating.toFixed(1) : 0}}</span>
                    <span class="datum__descriptor">RATING</span>
                    <span class="datum__rating"><img src="assets/images/rating.svg" alt="rating"></span>
                </div>
            </div>
            <div class="col-lg-6 col-9">
                <div class="datum">
                    <span class="datum__value">{{author && author.views ? author.views : 0}}</span>
                    <span class="datum__descriptor">Views</span>
                </div>
                <div class="datum">
                    <span class="datum__value">{{author && author.articlesCount ? author.articlesCount : 0}}</span>
                    <span class="datum__descriptor">Stories</span>
                </div>
                <div class="datum">
                    <span class="datum__value">{{author && author.subscribersCount ? author.subscribersCount : 0}}</span>
                    <span class="datum__descriptor">Followers</span>
                </div>
            </div>
        </div>
    </div>
    <div class="container" *ngIf="isCurrentUser">
        <div class="row" *ngIf="editMode">
            <div class="col-12 col-lg-8 offset-lg-2">
                <div class="grid-style grid-style--custom">
                    <div class="grid-style__info">
                        <h4>Your email: <span class="lighten">{{accountService.accountInfo.email}}</span></h4>
                    </div>
                    <div class="grid-style__choose">
                        <div>
                            <h4>{{listType | titlecase}} style</h4>
                            <p>Choose the way your readers will see your stories.</p>
                        </div>
                        <div class="grid-style__choose__item">
                            <span (click)="listType = 'grid'">
              <i class="grid-icon icon-multi-grid" [ngClass]="{'grid-icon--selected': (listType == 'grid')}"></i>
              <small>Grid</small>
            </span>
                            <span (click)="listType = 'single'">
                <i class="grid-icon icon-single-grid" [ngClass]="{'grid-icon--selected': (listType == 'single')}"></i>
                <small>List</small>
            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2 col-xl-9 stories">
                <div style="display: flex; justify-content: space-between">
                    <ui-tab *ngIf="isCurrentUser && !editMode" [className]="'author-tab'" (onTabChange)="tabChange($event)" [tabs]="tabs"></ui-tab>
                    <ng-container *ngIf="selectedTab == '2' && drafts">
                        <ui-button *ngIf="drafts.length" (btnClicked)="deleteAllDrafts()" [text]="'Delete All Drafts'" [className]="'delete-draft'"></ui-button>
                    </ng-container>
                </div>
                <div [ngClass]="{'editable-disabled' : editMode && publishedContent.length && (selectedTab == '1' || !isCurrentUser)}" *ngIf="publishedContent.length && (selectedTab == '1' || !isCurrentUser)" class="text-center">
                    <div *ngIf="listType == 'grid'" [class.masonry]="isMasonryLoaded" [useImagesLoaded]="true" (layoutComplete)="onLayoutComplete($event)" ngx-masonry [options]="masonryOptions">
                        <ui-content-single *ngFor="let data of publishedContent" (accountClick)="utilService.routerChangeHelper('account', $event.slug)" (contentClick)="utilService.routerChangeHelper('content',$event)" (publicationClick)="utilService.routerChangeHelper('publication',$event.slug)"
                            (tagClick)="utilService.routerChangeHelper('tag',$event)" ngxMasonryItem [type]="'grid'" [contentData]="data">
                        </ui-content-single>
                    </div>
                    <div *ngIf="listType == 'single'">
                        <ui-content-single *ngFor="let data of publishedContent" [type]="'single'" (accountClick)="utilService.routerChangeHelper('account', $event.slug)" (contentClick)="utilService.routerChangeHelper('content', $event)" (publicationClick)="utilService.routerChangeHelper('publication', $event.slug)"
                            (tagClick)="utilService.routerChangeHelper('tag',$event)" [contentData]="data"></ui-content-single>
                    </div>
                    <div class="empty" *ngIf="seeMoreLoading">
                        <div style="display: inline-block">
                            <mat-spinner></mat-spinner>
                        </div>
                    </div>
                    <ng-container *ngIf="seeMoreChecker">
                        <div class="search-results" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="50" [infiniteScrollDisabled]="blockInfiniteScroll" (scrolled)="seeMore()"></div>
                    </ng-container>
                </div>
                <div class="no-stories" >
                    <img src="assets/images/no_story.svg" alt="no story" />
                    <span>No Stories Yet</span>
                </div>
                <div *ngIf="selectedTab == '2' && drafts">
                    <div *ngIf="drafts && drafts.length > 0;else no_content">
                        <ui-draft *ngFor="let oDraft of drafts; let index = index" [type]="'single'" (deleteClick)="deleteDraft(oDraft.id, index)" (editClick)="editDraft(oDraft.id)" (contentClick)="editDraft(oDraft.id)" [draftData]="oDraft"></ui-draft>
                    </div>
                    <ng-template #no_content></ng-template>
                </div>
                <div *ngIf="selectedTab == '3'">
                    <p>Settings tab worked!</p>
                </div>
            </div>
        </div>
    </div>
</div>
